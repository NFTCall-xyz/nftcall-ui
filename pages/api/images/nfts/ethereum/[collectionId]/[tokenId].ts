import type { NextApiRequest, NextApiResponse } from 'next'

// fetch('https://api.thegraph.com/subgraphs/name/gordon199404/nftcall-stage', {
//   headers: {
//     accept: 'application/json, multipart/mixed',
//     'accept-language': 'zh-CN,zh;q=0.9',
//     'content-type': 'application/json',
//   },
//   body: '{"query":"{\\n  nfts(first: 1, where: {nftAddress:\\"0x00e08ef200f274604f0201b7f780a43df9cdebbf\\",tokenId:\\"4\\"}) {\\n    \\n      tokenId\\n      strikePriceGapIdx\\n      durationIdx\\n      lowerLimitOfStrikePrice: minimumStrikePrice\\n      status\\n      nftAddress\\n      callPoolAddress\\n      position {\\n        premiumToOwner\\n        strikePrice\\n        endTime\\n      }\\n    \\n  }\\n}"}',
//   method: 'POST',
// })

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  const { tokenId, collectionId } = req.query
  if (typeof tokenId !== 'string' || typeof collectionId !== 'string') return res.status(404).end()

  console.log('images', tokenId, collectionId)
  const svgString = `
  <svg width="1000" height="1000" viewBox="0 0 1000 1000" fill="none"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <g clip-path="url(#clip0_757_2279)">
      <rect width="1000" height="1000" fill="white" />
      <g clip-path="url(#clip1_757_2279)">
          <rect width="1000" height="1000" fill="#00040F" />
          <g filter="url(#filter0_f_757_2279)">
              <path
                  d="M52 320.8C52 172.346 172.346 52 320.8 52H679.2C827.654 52 948 172.346 948 320.8V679.2C948 827.654 827.654 948 679.2 948H320.8C172.346 948 52 827.654 52 679.2V320.8Z"
                  fill="url(#paint0_radial_757_2279)" />
              <path
                  d="M52 320.8C52 172.346 172.346 52 320.8 52H679.2C827.654 52 948 172.346 948 320.8V679.2C948 827.654 827.654 948 679.2 948H320.8C172.346 948 52 827.654 52 679.2V320.8Z"
                  stroke="black" />
          </g>
          <g filter="url(#filter1_f_757_2279)">
              <circle cx="492" cy="500" r="362" fill="white" fill-opacity="0.6" />
          </g>
      </g>
      <path
          d="M430.222 150.938C430.222 146.217 431.276 142 433.385 138.288C435.539 134.529 438.449 131.619 442.116 129.556C445.828 127.448 449.976 126.394 454.56 126.394C459.922 126.394 464.62 127.769 468.653 130.519C472.687 133.269 475.506 137.073 477.11 141.931H466.041C464.941 139.64 463.383 137.921 461.366 136.775C459.395 135.629 457.103 135.056 454.491 135.056C451.695 135.056 449.197 135.721 446.997 137.05C444.843 138.333 443.147 140.167 441.91 142.55C440.718 144.933 440.122 147.729 440.122 150.938C440.122 154.1 440.718 156.896 441.91 159.325C443.147 161.708 444.843 163.565 446.997 164.894C449.197 166.177 451.695 166.819 454.491 166.819C457.103 166.819 459.395 166.246 461.366 165.1C463.383 163.908 464.941 162.167 466.041 159.875H477.11C475.506 164.779 472.687 168.606 468.653 171.356C464.666 174.061 459.968 175.413 454.56 175.413C449.976 175.413 445.828 174.381 442.116 172.319C438.449 170.211 435.539 167.3 433.385 163.588C431.276 159.875 430.222 155.658 430.222 150.938Z"
          fill="#5CE1E6" />
      <path
          d="M482.856 155.819C482.856 151.969 483.612 148.554 485.124 145.575C486.683 142.596 488.768 140.304 491.381 138.7C494.039 137.096 496.995 136.294 500.249 136.294C503.091 136.294 505.566 136.867 507.674 138.013C509.829 139.158 511.547 140.602 512.831 142.344V136.913H522.524V175H512.831V169.431C511.593 171.219 509.874 172.708 507.674 173.9C505.52 175.046 503.022 175.619 500.181 175.619C496.972 175.619 494.039 174.794 491.381 173.144C488.768 171.494 486.683 169.179 485.124 166.2C483.612 163.175 482.856 159.715 482.856 155.819ZM512.831 155.956C512.831 153.619 512.372 151.625 511.456 149.975C510.539 148.279 509.301 146.996 507.743 146.125C506.185 145.208 504.512 144.75 502.724 144.75C500.937 144.75 499.287 145.186 497.774 146.056C496.262 146.927 495.024 148.211 494.062 149.906C493.145 151.556 492.687 153.527 492.687 155.819C492.687 158.111 493.145 160.127 494.062 161.869C495.024 163.565 496.262 164.871 497.774 165.788C499.333 166.704 500.983 167.163 502.724 167.163C504.512 167.163 506.185 166.727 507.743 165.856C509.301 164.94 510.539 163.656 511.456 162.006C512.372 160.311 512.831 158.294 512.831 155.956Z"
          fill="#5CE1E6" />
      <path d="M541.55 124.125V175H531.925V124.125H541.55Z" fill="#5CE1E6" />
      <path d="M560.684 124.125V175H551.059V124.125H560.684Z" fill="#5CE1E6" />
      <path
          d="M346.913 175H337.288L315.494 142.069V175H305.869V126.944H315.494L337.288 159.944V126.944H346.913V175Z"
          fill="white" />
      <path
          d="M386.056 127.013V134.781H366.049V147.088H381.381V154.719H366.049V175H356.424V127.013H386.056Z"
          fill="white" />
      <path d="M425.537 127.013V134.781H412.749V175H403.124V134.781H390.337V127.013H425.537Z"
          fill="white" />
      <path
          d="M619.724 126.856C624.212 126.856 628.292 127.899 631.964 129.984C635.681 132.069 638.605 134.971 640.736 138.688C642.912 142.36 644 146.508 644 151.132C644 155.801 642.912 159.995 640.736 163.712C638.605 167.384 635.681 170.263 631.964 172.348C628.247 174.433 624.167 175.476 619.724 175.476C615.281 175.476 611.201 174.433 607.484 172.348C603.767 170.263 600.82 167.384 598.644 163.712C596.513 159.995 595.448 155.801 595.448 151.132C595.448 146.508 596.513 142.36 598.644 138.688C600.82 134.971 603.767 132.069 607.484 129.984C611.201 127.899 615.281 126.856 619.724 126.856ZM619.724 135.628C616.868 135.628 614.329 136.263 612.108 137.532C609.932 138.801 608.232 140.615 607.008 142.972C605.784 145.329 605.172 148.049 605.172 151.132C605.172 154.215 605.784 156.935 607.008 159.292C608.232 161.649 609.932 163.485 612.108 164.8C614.329 166.069 616.868 166.704 619.724 166.704C622.58 166.704 625.096 166.069 627.272 164.8C629.448 163.485 631.148 161.672 632.372 159.36C633.596 157.003 634.208 154.26 634.208 151.132C634.208 148.004 633.596 145.284 632.372 142.972C631.148 140.615 629.448 138.801 627.272 137.532C625.096 136.263 622.58 135.628 619.724 135.628Z"
          fill="white" />
      <path
          d="M673.249 136.784C676.468 136.784 679.414 137.6 682.089 139.232C684.764 140.864 686.872 143.153 688.413 146.1C689.954 149.001 690.725 152.333 690.725 156.096C690.725 159.859 689.954 163.236 688.413 166.228C686.872 169.175 684.764 171.464 682.089 173.096C679.414 174.728 676.468 175.544 673.249 175.544C670.529 175.544 668.149 174.932 666.109 173.708C664.114 172.484 662.46 170.807 661.145 168.676V192.952H651.557V137.328H661.145V143.176C662.369 141.181 664.001 139.617 666.041 138.484C668.126 137.351 670.529 136.784 673.249 136.784ZM671.073 145.08C669.35 145.08 667.718 145.511 666.177 146.372C664.681 147.233 663.457 148.503 662.505 150.18C661.598 151.857 661.145 153.852 661.145 156.164C661.145 158.476 661.598 160.471 662.505 162.148C663.457 163.825 664.681 165.095 666.177 165.956C667.718 166.817 669.35 167.248 671.073 167.248C672.796 167.248 674.405 166.817 675.901 165.956C677.442 165.095 678.666 163.825 679.573 162.148C680.525 160.425 681.001 158.408 681.001 156.096C681.001 153.784 680.525 151.789 679.573 150.112C678.666 148.435 677.442 147.188 675.901 146.372C674.405 145.511 672.796 145.08 671.073 145.08Z"
          fill="white" />
      <path
          d="M717.417 166.976V175H711.365C707.511 175 704.542 174.116 702.457 172.348C700.371 170.58 699.329 167.656 699.329 163.576V145.148H695.317V137.328H699.329V128.012H708.917V137.328H717.349V145.148H708.917V163.576C708.917 164.8 709.211 165.684 709.801 166.228C710.39 166.727 711.41 166.976 712.861 166.976H717.417Z"
          fill="white" />
      <path
          d="M723.85 127.74C723.85 126.108 724.416 124.725 725.55 123.592C726.683 122.459 728.043 121.892 729.63 121.892C731.262 121.892 732.644 122.459 733.778 123.592C734.911 124.725 735.478 126.108 735.478 127.74C735.478 129.372 734.911 130.755 733.778 131.888C732.644 133.021 731.262 133.588 729.63 133.588C728.043 133.588 726.683 133.021 725.55 131.888C724.416 130.755 723.85 129.372 723.85 127.74ZM734.458 137.328V175H724.87V137.328H734.458Z"
          fill="white" />
      <path
          d="M761.523 136.784C765.104 136.784 768.368 137.577 771.315 139.164C774.261 140.751 776.596 143.017 778.319 145.964C780.041 148.865 780.903 152.243 780.903 156.096C780.903 159.949 780.041 163.349 778.319 166.296C776.596 169.243 774.239 171.532 771.247 173.164C768.3 174.751 765.013 175.544 761.387 175.544C757.805 175.544 754.541 174.751 751.595 173.164C748.648 171.532 746.313 169.243 744.591 166.296C742.913 163.349 742.075 159.949 742.075 156.096C742.075 152.243 742.936 148.865 744.659 145.964C746.381 143.017 748.716 140.751 751.663 139.164C754.609 137.577 757.896 136.784 761.523 136.784ZM761.455 144.876C758.735 144.876 756.445 145.851 754.587 147.8C752.728 149.749 751.799 152.537 751.799 156.164C751.799 158.612 752.229 160.697 753.091 162.42C753.997 164.097 755.176 165.367 756.627 166.228C758.077 167.044 759.664 167.452 761.387 167.452C763.064 167.452 764.651 167.021 766.147 166.16C767.643 165.299 768.844 164.029 769.751 162.352C770.703 160.629 771.179 158.567 771.179 156.164C771.179 153.716 770.725 151.653 769.819 149.976C768.912 148.253 767.711 146.984 766.215 146.168C764.764 145.307 763.177 144.876 761.455 144.876Z"
          fill="white" />
      <path
          d="M809.771 136.784C812.581 136.784 815.075 137.419 817.251 138.688C819.472 139.912 821.217 141.748 822.487 144.196C823.756 146.599 824.391 149.477 824.391 152.832V175H814.871V154.192C814.871 151.245 814.123 149.001 812.627 147.46C811.131 145.873 809.091 145.08 806.507 145.08C803.923 145.08 801.86 145.873 800.319 147.46C798.823 149.001 798.075 151.245 798.075 154.192V175H788.487V137.328H798.075V142.972C799.253 140.977 800.84 139.459 802.835 138.416C804.875 137.328 807.187 136.784 809.771 136.784Z"
          fill="white" />
      <path
          d="M223 100C213.111 100 203.444 102.932 195.221 108.427C186.999 113.921 180.59 121.73 176.806 130.866C173.022 140.002 172.031 150.055 173.961 159.755C175.89 169.454 180.652 178.363 187.645 185.355C194.637 192.348 203.546 197.11 213.245 199.039C222.945 200.969 232.998 199.978 242.134 196.194C251.27 192.41 259.079 186.001 264.573 177.779C270.068 169.556 273 159.889 273 150L253 150C253 155.933 251.241 161.734 247.944 166.667C244.648 171.601 239.962 175.446 234.48 177.716C228.999 179.987 222.967 180.581 217.147 179.424C211.328 178.266 205.982 175.409 201.787 171.213C197.591 167.018 194.734 161.672 193.576 155.853C192.419 150.033 193.013 144.001 195.284 138.519C197.554 133.038 201.399 128.352 206.333 125.056C211.266 121.759 217.067 120 223 120L223 100Z"
          fill="white" />
      <path
          d="M221.985 165.589C213.356 165.009 206.831 157.541 207.411 148.985C208.063 140.356 215.459 133.831 224.088 134.411C232.644 135.063 239.169 142.459 238.589 151.088C238.009 159.644 230.541 166.169 221.985 165.589Z"
          fill="url(#paint1_radial_757_2279)" />
      <path fill-rule="evenodd" clip-rule="evenodd"
          d="M232.375 100H273V112.5H273L273 140.625H260.5L260.5 123.385L248.545 135.34L237.496 124.292L249.288 112.5H232.375V100Z"
          fill="#5CE1E6" />
      <rect x="200" y="280" width="600" height="600" rx="30" fill="url(#pattern0)" />
  </g>
  <defs>
      <filter id="filter0_f_757_2279" x="-548.5" y="-548.5" width="2097" height="2097"
          filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix" />
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
          <feGaussianBlur stdDeviation="300" result="effect1_foregroundBlur_757_2279" />
      </filter>
      <filter id="filter1_f_757_2279" x="-1370" y="-1362" width="3724" height="3724"
          filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix" />
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
          <feGaussianBlur stdDeviation="750" result="effect1_foregroundBlur_757_2279" />
      </filter>
      <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
          <use xlink:href="#nft-image" transform="scale(0.00158479)" />
      </pattern>
      <radialGradient id="paint0_radial_757_2279" cx="0" cy="0" r="1"
          gradientUnits="userSpaceOnUse"
          gradientTransform="translate(500 500) rotate(90) scale(448)">
          <stop stop-color="#BCA5FF" stop-opacity="0" />
          <stop offset="1" stop-color="#214D76" />
      </radialGradient>
      <radialGradient id="paint1_radial_757_2279" cx="0" cy="0" r="1"
          gradientUnits="userSpaceOnUse"
          gradientTransform="translate(229.611 145.529) rotate(93.8705) scale(20.1016)">
          <stop offset="0.00887753" stop-color="#DEF9FA" />
          <stop offset="0.1723" stop-color="#BEF3F5" />
          <stop offset="0.4204" stop-color="#9DEDF0" />
          <stop offset="0.5512" stop-color="#7DE7EB" />
          <stop offset="0.7154" stop-color="#5CE1E6" />
          <stop offset="1" stop-color="#33BBCF" />
      </radialGradient>
      <clipPath id="clip0_757_2279">
          <rect width="1000" height="1000" fill="white" />
      </clipPath>
      <clipPath id="clip1_757_2279">
          <rect width="1000" height="1000" fill="white" />
      </clipPath>
      <image id="nft-image" width="631" height="631"
          href="https://i.seadn.io/gcs/files/35cd53bba032f245010970702b93bf7c.png" />
  </defs>
</svg>
  `

  // 设置响应头为SVG格式
  res.setHeader('Content-Type', 'image/svg+xml')

  // 将SVG发送回客户端
  res.end(svgString)
}
